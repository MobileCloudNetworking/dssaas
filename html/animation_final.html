<!DOCTYPE html>
<!-- saved from url=(0049)http://valipoor.com/files/animation_complete.html -->
<html pmbx_context="EE18CC7E-25DD-4F54-886E-1A155CBF94BE"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Service Status</title>
<script type="text/javascript" src="./animation_files/raphael-min.js"></script>
<script type="text/javascript" src="./animation_files/jquery-2.1.4.min.js"></script>
</head>

<body>
    <!--<label>From:</label>
    <select name="orig" id="orig">
        <option value="so">SO</option>
        <option value="cms">CMS</option>
        <option value="mcr">MCR</option>
        <option value="sm">SM</option>
        <option value="player">Player</option>
    </select>
    <label>To:</label>
    <select name="dest" id="dest">
        <option value="so">SO</option>
        <option value="cms">CMS</option>
        <option value="mcr">MCR</option>
        <option value="slaaas">SLAaaS</option>
        <option value="icnaas">ICNaaS</option>
        <option value="aaaaas">AAAaaS</option>
        <option value="monaas">MONaaS</option>
        <option value="dnsaas">DNSaaS</option>
    </select>-->
    <button name="snd_msg" id="snd_msg" style="visibility:hidden">Send Message</button>
    <div id="sm" style="position:absolute; left:412px; top: 140px; border:1px solid;  width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">SM</div>
    <div id="so" style="position:absolute; left:412px; top: 230px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">SO</div>
    <div id="slaaas" style="position:absolute; left:200px; top: 350px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">SLAaaS</div>
    <div id="aaaaas" style="position:absolute; left:320px; top: 350px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">AAAaaS</div>
    <div id="dnsaas" style="position:absolute; left:440px; top: 350px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">DNSaaS</div>
    <div id="monaas" style="position:absolute; left:560px; top: 350px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">MONaaS</div>   
    <div id="icnaas" style="position:absolute; left:680px; top: 350px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">ICNaaS</div>
    
    <div style="position:absolute; left:320px; top: 500px; border:2px dotted; width:2.49in; height:1.85in; text-align: left; padding:5px 0px 0px 0px;"></div>
    <div style="position:absolute; left:329px; top: 505px; border:1px solid; width:0.9in; height:1.75in; text-align: left; padding:5px 0px 0px 0px;"></div>
    <div id="cms1" style="position:absolute; left:335px; top: 510px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">CMS 1</div>
    <div id="cms2" style="position:absolute; left:335px; top: 567px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">CMS 2</div>
    <div id="cms3" style="position:absolute; left:335px; top: 624px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">CMS 3</div>
    
    <div id="mcr" style="position:absolute; left:450px; top: 510px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">MCR</div>    
    <div id="db" style="position:absolute; left:450px; top: 624px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">DB</div>
    
    <div id="lbaas" style="position:absolute; left:200px; top: 567px; border:1px solid #000; opacity:0.04; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">LB</div>
    <div id="player" style="position:absolute; left:70px; top: 567px; border:1px solid; width:0.76in; height:0.46in; text-align: center; padding:5px 0px 0px 0px;">Player</div>
    <div id="holder"></div>
<script>
    
var services_points = {
    "so_from_sm": [
        { "shape": "M 441,161 L 441,200", "x_begin": 441, "y_begin": 161, "x_end": 441, "y_end": 200}
    ],
    "slaaas_from_so": [
        { "shape": "M 441,252 L 230,321", "x_begin": 441, "y_begin": 252, "x_end": 230, "y_end": 320}
    ],
	"aaaaas_from_so": [
        { "shape": "M 441,252 L 350,321", "x_begin": 441, "y_begin": 252, "x_end": 350, "y_end": 320}
    ],
	"dnsaas_from_so": [
        { "shape": "M 441,252 L 470,321", "x_begin": 441, "y_begin": 252, "x_end": 470, "y_end": 320}
    ],
	"monaas_from_so": [
        { "shape": "M 441,252 L 590,321", "x_begin": 441, "y_begin": 252, "x_end": 590, "y_end": 320}
    ],
	"icnaas_from_so": [
        { "shape": "M 441,252 L 710,321", "x_begin": 441, "y_begin": 252, "x_end": 710, "y_end": 320}
    ],
	"cms_from_so": [
        { "shape": "M 478,222 L 775,222 L 775,670 L 365,670 L 365,650", "x_begin": 478, "y_begin": 227, "x_end": 365, "y_end": 652}
    ],
	"mcr_from_so": [
        { "shape": "M 478,232 L 765,232 L 765,660 L 605,660 L 605,506 L 516,506", "x_begin": 478, "y_begin": 227, "x_end": 516, "y_end": 506}
    ],
	"db_from_so": [
        { "shape": "M 478,227 L 770,227 L 770,665 L 600,665 L 600,622 L 516,622", "x_begin": 478, "y_begin": 227, "x_end": 516, "y_end": 622}
    ],
	//-----------------------------------------------------------------------------------------------
	"slaaas_from_cms": [
        { "shape": "M 365,475 L 230,371", "x_begin": 365, "y_begin": 474, "x_end": 230, "y_end": 373}
    ],
	"aaaaas_from_cms": [
        { "shape": "M 365,475 L 350,371", "x_begin": 365, "y_begin": 474, "x_end": 350, "y_end": 373}
    ],
	"dnsaas_from_cms": [
        { "shape": "M 365,475 L 470,371", "x_begin": 365, "y_begin": 474, "x_end": 470, "y_end": 373}
    ],
	"monaas_from_cms": [
        { "shape": "M 365,475 L 590,371", "x_begin": 365, "y_begin": 474, "x_end": 590, "y_end": 373}
    ],
	"db_from_cms": [
        { "shape": "M 409,565 L 481,594", "x_begin": 410, "y_begin": 565, "x_end": 481, "y_end": 594}
    ],
	"mcr_from_cms": [
        { "shape": "M 409,565 L 481,531", "x_begin": 410, "y_begin": 565, "x_end": 481, "y_end": 533}
    ],
	"lbaas_from_cms": [
        { "shape": "M 322,565 L 266,565", "x_begin": 320, "y_begin": 565, "x_end": 268, "y_end": 565}
    ],
	//-----------------------------------------------------------------------------------------------
	"dnsaas_from_mcr": [
        { "shape": "M 481,480 L 470,371", "x_begin": 481, "y_begin": 480, "x_end": 470, "y_end": 373}
    ],
	"monaas_from_mcr": [
        { "shape": "M 481,480 L 590,371", "x_begin": 481, "y_begin": 480, "x_end": 590, "y_end": 373}
    ],
	"icnaas_from_mcr": [
        { "shape": "M 481,480 L 710,371", "x_begin": 481, "y_begin": 480, "x_end": 710, "y_end": 373}
    ],
    "db_from_mcr": [
        { "shape": "M 481,531 L 481,594", "x_begin": 481, "y_begin": 533, "x_end": 481, "y_end": 594}
    ],
	//-----------------------------------------------------------------------------------------------
	"player_from_lbaas": [
        { "shape": "M 192,565 L 136,565", "x_begin": 190, "y_begin": 565, "x_end": 138, "y_end": 565}
    ],
	//-----------------------------------------------------------------------------------------------
	"icnaas_from_player": [
        { "shape": "M 100,587 L 100,690 L 710,690 L 710, 371", "x_begin": 100, "y_begin": 590, "x_end": 710, "y_end": 373}
    ],
};

index_line_map = {};

var myE = [];
var myPath = [];
var myCounter = [];
var myAnimation = [];  //make the variables global, so you can access them in the animation function
var myMaxCount = [];

window.onload = function() {

    /*$("#snd_msg").click(function(){
        orig_value = $("#orig").val();
        dest_value = $("#dest").val();
        
        if(orig_value == dest_value){
            alert("Ops! Sender and reciever are the same :-/");
            return;
        }
        if(dest_value == 'sm'){
            alert("No link found!");
            return;
        }
        if(orig_value != 'sm' && dest_value == 'so'){
            alert("No link found!");
            return;
        }
        if(orig_value == 'sm' && dest_value == 'so'){
            startIt( dest_value + '_from_' + orig_value,'s');
            return;
        }
		try{
			startIt( dest_value + '_from_' + orig_value,'s');
		} catch(e) {
			alert("No link found!");
            return;
		}
    });*/

    var r = Raphael("holder", 1500, 900),
        discattr = {
            fill: "#666",
            stroke: "none"
        };
	
	function line(c_shape, x, y, ex, ey, color, path_tag){
        
        myE[index_line_map[path_tag]] = r.circle(x, y, 3, 3).attr({
            stroke: "none",
            fill: color,
			opacity: 0.0
        });
		myE[index_line_map[path_tag]].node.id = path_tag + "_msgdot";
                                                     
        myPath[index_line_map[path_tag]] = r.path( c_shape );
		myPath[index_line_map[path_tag]].attr("stroke", "none");
		myPath[index_line_map[path_tag]].node.id = path_tag + "_msgline";
        myCounter[index_line_map[path_tag]] = 0;
        
        
        
		//controls = r.set(
        //    r.circle(x, y, 3).attr({"fill":"gray","stroke":"none"}), r.circle(ex, ey, 3).attr({"fill":"gray","stroke":"none"}));
	}
    
    var index_tracer = 0;
    jQuery.each(services_points, function(i, val) {
        index_line_map[i] = index_tracer;
        line(val[0].shape, val[0].x_begin, val[0].y_begin, val[0].x_end, val[0].y_end,"green",i);
        index_tracer++;
    });
    
	console.log(index_line_map);
	
	setInterval(updateGraph, 5000);
	setInterval(showMessageTransfer,7000);
};

var counter = 0;    // a counter that counts animation steps
var i = 0;
function startIt(con_name,direction){
    myMaxCount[index_line_map[con_name]] = 0;
    clearInterval(myAnimation[index_line_map[con_name]]);
    if(direction == 'r'){
        myCounter[index_line_map[con_name]] = myPath[index_line_map[con_name]].getTotalLength();
        myAnimation[index_line_map[con_name]] = window.setInterval("reverse_animate(" + index_line_map[con_name] + ")", 5);//execute the animation function all 10ms (change the value for another speed)
    } else {
        myCounter[index_line_map[con_name]] = 0;
    	myAnimation[index_line_map[con_name]] = window.setInterval("animate(" + index_line_map[con_name] + ")", 5);//execute the animation function all 10ms (change the value for another speed)
    }
}

function animate(index){
    if(myPath[index].getTotalLength() <= myCounter[index]){   //break as soon as the total length is reached
        myCounter[index] = 0;
        myMaxCount[index]++;
		if (myMaxCount[index] >= 1){
			clearInterval(myAnimation[index]);
			myE[index].attr({opacity: 0.0});
			return;
		}
    }
    var pos = myPath[index].getPointAtLength(myCounter[index]);   //get the position (see Raphael docs)
    myE[index].attr({cx: pos.x, cy: pos.y, opacity: 1.0});  //set the circle position
    
    myCounter[index]++; // count the step counter one up
};

function reverse_animate(index){
    if(myCounter[index] <= 0){   //break as soon as the total length is reached
        myCounter[index] = myPath[index].getTotalLength();
        myMaxCount[index]++;
        if (myMaxCount[index] >= 1){
            clearInterval(myAnimation[index]);
			myE[index].attr({opacity: 0.0});
            return;
        }
    }
    var pos = myPath[index].getPointAtLength(myCounter[index]);   //get the position (see Raphael docs)
    myE[index].attr({cx: pos.x, cy: pos.y, opacity: 1.0});  //set the circle position
    
    myCounter[index]--; // count the step counter one up
};

var prev_json = '';
var at_least_one_cms_active = false;
var updateGraph = function () {
  $.get('http://54.171.14.235:8055/v1.0/service_ready', function (data) {
	//update
	if(prev_json != JSON.stringify(data)){
		prev_json = JSON.stringify(data);
		at_least_one_cms_active = false;
		$.each(data, function(i, v){
			if((i == "cms1" || i == "cms2" || i == "cms3") && v != "None"){
				at_least_one_cms_active = true;
			}
		});
		$.each(data, function(i, v){
			if(v == "deployed"){
				$.each(myPath, function(index, value){
					if(value.node.id.indexOf(i + "_from") >= 0){
						value.attr("stroke", "black");	
					}
					if(i.indexOf("cms") >= 0){
						if(value.node.id.indexOf("cms_from") >= 0){
							value.attr("stroke", "black");	
						}	
					}
					if(i == "lbaas"){
						myPath[index_line_map["player_from_lbaas"]].attr("stroke", "black");
					}
				});
				$("#"+i).css({
					"border": "1px solid black",
					"color": "black"
				});
				$("#"+i).animate({
					opacity: 1.0,
				}, 1000 );
			} else if(v == "configured") {
				$("#"+i).css({
					"border": "1px solid green",
					"color": "green"
				});
			} else {
				$.each(myPath, function(index, value){
					if(value.node.id.indexOf(i + "_from") >= 0){
						value.attr("stroke", "none");	
					}
					if(i.indexOf("cms") >= 0 && !at_least_one_cms_active){
						if(value.node.id.indexOf("cms_from") >= 0){
							value.attr("stroke", "none");	
						}	
					}
					if(i == "lbaas"){
						myPath[index_line_map["player_from_lbaas"]].attr("stroke", "none");
					}
				});
				$("#"+i).animate({
					opacity: 0.04,
				}, 1000 );
			}	
		});
	}
  });
}

var showMessageTransfer = function () {
	$.post( 'http://54.171.14.235:8055/v1.0/auth', '{"user":"HTML5","password":"HTML5"}', function( data ) {
		try {
			$.post( 'http://54.171.14.235:8055/v1.0/message', '{"user":"HTML5","token":"' + data['token'] + '"}', function( data ) {
				try {
					if(data["to"] != "dummy"){
						startIt( data["to"] + '_from_' + data["from"],'s');
						console.log(data["task"] + " at " + data["date_time"])
					} else {
						console.log("Message queue is empty!");
					}
				} catch(e) {
					console.log(e.toString());
				}
			}, "json");
		} catch(e) {
			console.log(e.toString());
		}
	}, "json");
}
</script>

<i title="Raphaël Colour Picker" style="display: none; color: green;"></i></body></html>